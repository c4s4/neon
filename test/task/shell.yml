doc: Built file to test tasks
default: [task_$, task_multi$]

properties:
  BUILD_DIR: '../../build'

targets:

  task_$:
    doc: Test task $
    steps:
    - if: '_OS != "windows"'
      then:
      # test shell
      - $: 'echo "TEST"'
        =: 'result'
      - |
        if result != "TEST" {
          throw("$ test failure")
        } else {
          println("$ test success")
        }
      # test command
      - $: ['echo', 'TEST']
        =: 'result'
      - |
        if result != "TEST" {
          throw("$ test failure")
        } else {
          println("$ test success")
        }
      # test shell with property
      - 'message = "foo"'
      - $: 'echo "={message}"'
        =: 'result'
      - |
        if result != "foo" {
          throw("$ test failure")
        } else {
          println("$ test success")
        }
      # test command with property
      - 'message = "foo"'
      - $: ['echo', '={message}']
        =: 'result'
      - |
        if result != "foo" {
          throw("$ test failure")
        } else {
          println("$ test success")
        }

  task_multi$:
    doc: Run shell commands in a loop
    steps:
    - for: 'i'
      in:  'range(3)'
      do:
      - $: ['echo', '={i}']
        =: 'result'
      - assert: 'result == toString(i)'
